---
title: "ICU Message Format и с чем его едят"
description: "Чтобы облегчить жизнь переводчиков, умные люди из проекта ICU создали формат сообщений с лёгким и понятным синтаксисом. Объясняем как его использовать."
meta:
  scripts:
    - neat-table
    - icu-tester
---

{{ page.description }}

[[toc]]

## Что представляет из себя ICU Message Format

Проект ICU (International Components for Unicode, *рус.* международные компоненты юникода) — это набор библиотек для использования при создании программного обеспечения, чтобы упростить процесс его локализации.

Мы заинтересованы в одной из них — ICU Message Format (дальше будем называть просто ICU). Она позволяет с лёгкостью форматировать «сообщения» согласно нормам языка. Переводчиков сама часть использования библиотеки не касается: мы изучаем конкретно её синтаксис.

Пример строки, где применяется ICU:

```icu
{username}, у вас {messages, plural, one {имеется одно} few {имеются # непрочитаных сообщения} other {имеются # непрочитаных сообщений}}
```

Можно заметить что в этой строке используются переменная для имени пользователя (`{username}`) и множественное число для сообщений (`{messages, plural, …}`). О всех этих типах, именуемых «аргументами», мы будем говорить здесь.

### Аргументы

Как понятно из вышеописанного, аргументы представляют из себя заменяемые объекты. Некоторые аргументы используют данными, чаще всего взятые из [Unicode CLDR](http://cldr.unicode.org/), например для форматирования дат или выбора правильной категории множественного числа.

Разберём каждый из типов аргументов.

#### Аргумент сам по себе

Аргумент без указания типа представляют собой переменные, которые будут заменены на необходимый потом текст. **Ни название переменной, ни тип, ни стиль или категории не должны переводиться.**

Любой аргумент — переменная, независимо от его типа. Тип всего лишь определяет в какой формат будет преобразованы исходные данные.

То есть, если вы замените `{messages, plural, …}` на просто `{messages}`, вы получите исходное число в виде текста `1`, `100`, `10000`, т. п. Вы также можете поменять тип и допустим, сделать чтобы `{messages}` отображалось как число — `{messages, number}`, результат будет выглядеть как `1`, `100`, `10 000` и т. д.

{% capture type_warning %}

**Будьте осторожны с экспериментированием над типами переменных и делайте это только когда знаете ожидаемый формат данных**: текст, например, не может быть преобразован в число и это приведёт к ошибке.

{% endcapture %}

{% include note.html type="warning" content=type_warning %}

#### Тип `number` (число)

Аргумент типа «число» принимает изначальное число и преобразует его к отображению в текущей локали, расставляя пробелы где это требуется и используя нужный разделитель для десятичных чисел.

> `{messages, number}`
> \+ **messages**: `123456`
>
> В английском — `123,456`. В русском — `123 456`.

Поддерживаются несколько стилей.

|   Стиль    |  Пример  |           Примечание           |
| :--------: | :------: | :----------------------------: |
| `integer`  | `12 346` |                                |
| `percent`  |  `99 %`  |                                |
| `currency` |  `10 ₽`  | **Не поддерживается Mastodon** |


#### Тип `time` / `date` (время / дата)

- Аргумент типа «время» принимает изначально объект даты, а затем преобразует его в строку времени согласно стандартам текущей локали в необходимом стиле (если указан).
- «Дата» делает точно также с одни лишь отличием — она выводит дату.

> `{alarm_time, time, short}`
> \+ **alarm_time**: `13:00:00`
>
> В английском — `1:00 PM`. В русском — `13:00`.

> `{event_time, time, full}`
> \+ **event_date**: `29 июня 2019 г., 12:00`
>
> В английском — `Saturday, June 29, 2019`. В русском — `суббота, 29 июня 2019 г.`.

##### Список стилей

Из примеров выше можно увидеть `short`, `long` и т. д. Это стили — формат оформления времени или даты.

Изначально доступны несколько заготовленных стилей, но если потребуется, всегда можно использовать собственный «каркас» (формат). Вот список:

<table data-neat-cols-override="Стиль,Пример (время),Пример (дата)" class="styles-list">
  <thead>
    <tr>
      <th rowspan="2">Стиль</th>
      <th colspan="2">Пример</th>
    </tr>
    <tr>
      <th>Время</th>
      <th>Дата</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>short</code></td>
      <td><code>12:00</code></td>
      <td><code>29.06.19</code></td>
    </tr>
    <tr>
      <td><code>medium</code></td>
      <td><code>12:00:00</code></td>
      <td><code>29 июн. 2019 г.</code></td>
    </tr>
    <tr>
      <td><code>long</code></td>
      <td><code>12:00:00 GMT+7</code></td>
      <td><code>29 июня 2019 г.</code></td>
    </tr>
    <tr>
      <td><code>full</code></td>
      <td><code>12:00:00 GMT+7</code></td>
      <td><code>суббота, 29 июня 2019 г.</code></td>
    </tr>
    <tr>
      <td><code>::dMMMM</code></td>
      <td colspan="2" data-column="Пример (общ.)"><code>29 июня</code></td>
    </tr>
  </tbody>
</table>

<style>
  table.styles-list td {
    text-align: center;
  }
</style>


- [Как оформляются «каркасы»](https://ssl.icu-project.org/apiref/icu4j/com/ibm/icu/text/SimpleDateFormat.html) (англ.)

#### Тип `select` (выбор)

Аргумент «выбор» позволяет нам выбирать вложенное сообщение в зависимости от изначального содержимого переменной. Этакое условие «если-то».

Пример `select`-a:

```icu
{gender, select, =male {Играл} =female {Играла} other {Играл(а)}} недавно
```

В отличии от «даты» и «времени» в конце аргумента указываются вложенные сообщения по категориям («совпадениям»). В `select`-ах допустимы собственные категории и требуется категория `other` (если ни одна другая категория не подходит).

#### Тип `plural` (множественное число)

Аргумент «множественное число» очень похож на `select`, единственные отличия — у него есть дополнительные категории, которые выбираются согласно правилам для множественных чисел языка, а собственные категории указываются через `=[число]`.

```icu
{users, plural, one {# пользователь} few {# пользователя} other {# пользователей}}
```

В русском языке применяются следующие категории:

| Категория | Охватываемые числа                      |
| :-------: | :-------------------------------------- |
|   `one`   | `1`, `21`, `31`, `101`, …               |
|   `few`   | `2`, `3`, `4`, `22`, …                  |
|  `many`   | `5`, `6`, `27`, `108`, …                |
|  `other`  | `0.0-1.5`, `10.0`, `100.0`, `1000.0`, … |

{% capture other_plural %}

Так как в `plural`-ах обязательно наличие `other`, в русском языке им можно заменить `many`, если известно, что исходные числа никогда не будут дробными.

{% endcapture %}

{% include note.html type="information" content=other_plural %}

##### Собственные категории

Иногда вам может попасться вот такой `plural` в оригинальной строке:

```icu
{apps, plural, one {App {app}} other {# apps}} can control your account.
```

В этом случае стоит вспомнить, что в английском `one` применяется только к числам `-1` и `1`, когда как в русском и к `21`, `31` и т. д. Справиться с таким `plural`-ом поможет собственная категория («совпадение») `=1`, которая будет выбираться только когда число равно 1, минуя категорию `one`:

```icu
{apps, plural, =1 {Приложение {app} может} one {# приложение может} few {# приложения могут} other {# приложений могут}} управлять вашей учётной записью.
```

##### Дополнительные материалы

- [Список правил для `plural`-ов — Unicode CLDR](https://unicode.org/cldr/charts/latest/supplemental/language_plural_rules.html)

## Полезности

- [Синтаксис сообщений ICU — База знаний Crowdin](https://support.crowdin.com/ru/icu-message-syntax/)
- [Редактор ICU от Энди ВанВагонера](https://format-message.github.io/icu-message-format-for-translators/editor.html). Каждый пример на этой странице открывает его
- [Message Syntax — FormatJS](https://formatjs.io/guides/message-syntax/) (англ.). Гайд создателей библиотеки, используемой в Mastodon.

<style>code { white-space: normal; }</style>
